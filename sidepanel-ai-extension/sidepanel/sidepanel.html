<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Side Panel Agent</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../sidepanel/sidepanel.css" />
</head>
<body>
<header class="chat-header">
  <img src="../icons/icon32.png" alt="icon" class="logo" />
  <h1>AI Assistant</h1>
  <div class="header-actions">
    <button id="toggleActivityBtn" title="Toggle Activity Panel" class="icon-btn" aria-pressed="false" aria-controls="activityPanel" aria-label="Toggle agent activity panel">üß≠</button>
    <button id="clearChatBtn" title="Clear chat history" class="icon-btn" aria-label="Clear chat history">üßπ</button>
    <button id="openOptionsBtn" title="Settings" class="icon-btn" aria-label="Settings">‚öôÔ∏è</button>
    <button id="agentStopBtn" class="stop-btn" title="Emergency STOP" aria-label="Emergency Stop">STOP</button>
  </div>
</header>

<!-- Experimental Feature Flags -->
  <div id="featureFlags" class="feature-flags" role="group" aria-label="Experimental features">
    <label class="toggle"><input id="flagGraphMode" type="checkbox" /> Graph Mode</label>
    <label class="toggle"><input id="flagFastMode" type="checkbox" title="Reduce waits and visuals for faster actions" /> Fast Mode</label>
    <label class="toggle"><input id="flagReactPlanner" type="checkbox" /> ReAct Planner</label>
    <span id="plannerStatusPill" class="planner-pill linear" title="Planner used for last run">Planner: Linear</span>
  </div>
<!-- Split layout: left chat pane, right activity drawer -->
<main class="sp-layout" id="spLayout">
  <section class="sp-chat" id="chatPane" role="region" aria-label="Chat">
    <div id="stepperBar" class="stepper-bar" role="status" aria-live="polite" hidden></div>
    <div id="chatMessages" class="chat-messages" role="log" aria-live="polite" aria-relevant="additions text" aria-atomic="false"></div>
    <div class="chat-input-area">
      <div class="input-controls">
        <textarea id="chatInput" placeholder="Ask me anything or give me a task to perform..." rows="2" aria-label="Message input"></textarea>
        <div class="input-actions">
          <button id="sendBtn" class="send-btn" title="Send message" aria-label="Send message">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" focusable="false">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
            </svg>
          </button>
        </div>
      </div>

      <!-- Context chips: auto-filled with current tab URL and other context -->
      <div class="context-chips" id="contextChips" aria-label="Context attachments" role="group"></div>

      <!-- Quick actions toolbar for one-tap intents -->
      <div class="quick-actions" role="toolbar" aria-label="Quick actions">
        <button id="qaSummarize" class="quick-btn" title="Summarize this page" aria-label="Summarize this page">Summarize page</button>
        <button id="qaExtractLinks" class="quick-btn" title="Extract all links from this page" aria-label="Extract all links from this page">Extract links</button>
        <button id="qaOutline" class="quick-btn" title="Create an outline of this page" aria-label="Create an outline of this page">Outline</button>
        <button id="qaNavigate" class="quick-btn" title="Prepare navigation request" aria-label="Prepare navigation request">Navigate to‚Ä¶</button>
      </div>

      <!-- Autonomous Task Templates -->
      <div class="automation-templates" id="automationTemplates" role="region" aria-label="Autonomous task templates">
        <div class="templates-header">
          <h3>ü§ñ Autonomous Tasks</h3>
          <small>Let the AI agent perform complex multi-step tasks automatically</small>
        </div>
        <div class="templates-grid" id="templatesGrid">
          <!-- Templates will be populated dynamically -->
        </div>
      </div>
    </div>
  </section>

  <aside class="sp-activity collapsed" id="activityPanel" role="region" aria-label="Agent Activity">
    <header class="sp-activity-header">
      <strong>Agent Activity</strong>
      <div class="sp-activity-actions">
        <select id="activityFilter" class="filter-select" aria-label="Filter logs">
          <option value="all">All</option>
          <option value="info">Info</option>
          <option value="warn">Warnings</option>
          <option value="error">Errors</option>
          <option value="success">Success</option>
        </select>
        <input id="activitySearch" class="search-input" type="search" placeholder="Search logs..." aria-label="Search logs" />
        <button id="collapseActivityBtn" class="icon-btn" title="Collapse" aria-label="Collapse activity panel">‚Æú</button>
      </div>
    </header>
    <div class="sp-activity-body" id="activityBody">
      <!-- Success Criteria Checklist -->
      <div id="successCriteria" class="success-criteria-container"></div>
      <!-- Findings Table -->
      <div id="findingsTable" class="findings-container"></div>
      <!-- Grouped log container -->
      <div id="activityGroups"></div>
    </div>
    <footer class="sp-activity-footer">
      <small class="muted">Live updates while agent runs</small>
    </footer>
  </aside>
</main>

  <!-- Agent Mode Modal -->
  <div id="agentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Agent Mode Settings</h3>
        <button id="closeAgentModal" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="agentGoal">Goal</label>
          <input id="agentGoal" type="text" placeholder="Describe what you want me to do..." />
        </div>
        <div class="toggles">
          <label class="toggle"><input id="allowCrossDomain" type="checkbox" checked /> Cross-domain navigation</label>
          <label class="toggle"><input id="allowTabMgmt" type="checkbox" checked /> Tab management</label>
          <label class="toggle"><input id="autoScreenshots" type="checkbox" /> Auto screenshots</label>
          <label class="toggle compact">Max steps <input id="maxSteps" type="number" value="12" min="1" max="50" /></label>
        </div>
      </div>
      <div class="modal-footer">
        <button id="agentStartBtn" class="primary">Start Agent</button>
        <button id="cancelAgentBtn" class="secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Tasks Modal -->
  <div id="tasksModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Task Manager</h3>
        <button id="closeTasksModal" class="close-btn">&times;</button>
      </div>
      <div class="modal-body">
        <div class="todo-inputs">
          <input id="taskTitle" type="text" placeholder="New task title" />
          <button id="addTaskBtn">Add</button>
        </div>
        <ul id="taskList" class="task-list"></ul>
      </div>
    </div>
  </div>

  <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>

  <script src="../common/messages.js"></script>
  <script src="../common/automation-templates.js"></script>
  <script src="../common/prompts.js"></script>
  <script src="../lib/marked.min.js"></script>
  <script src="../sidepanel/sidepanel.js" type="module"></script>
</body>
</html>